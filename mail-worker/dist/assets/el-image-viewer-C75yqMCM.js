import{aC as J,b as ye,d as Q,av as Ie,_ as Ce,a as se,ba as U,bb as xe,bc as Ne,as as ze,u as Ee,bd as Le,s as y,be as Oe,a9 as Te,k as b,a3 as ee,v as Re,x as z,y as ae,o as w,z as d,N as l,G as $e,f as m,i as te,n as c,g as a,e as h,c as E,r as D,D as Se,E as k,m as Me,F as P,aI as Ve,aH as Ye,h as Ae,t as De,bf as Pe,bg as Be,B as Xe,bh as Fe,bi as He,a5 as Ke,ad as We,I,a4 as qe,w as Ge}from"./index-CrVLGAV5.js";import{a as Ze,b as je}from"./vnode-DMmxwG2F.js";import{t as B}from"./throttle-DgkiUC1P.js";const Je=ye({urlList:{type:Q(Array),default:()=>Ie([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Q(String)}}),Qe={close:()=>!0,switch:C=>J(C),rotate:C=>J(C)},Ue=se({name:"ElImageViewer"}),ea=se({...Ue,props:Je,emits:Qe,setup(C,{expose:ne,emit:L}){var X;const r=C,x={CONTAIN:{name:"contain",icon:U(Ne)},ORIGINAL:{name:"original",icon:U(xe)}};let $,F="";const{t:oe}=ze(),s=Ee("image-viewer"),{nextZIndex:le}=Le(),S=y(),H=y([]),K=Oe(),_=y(!0),u=y(r.initialIndex),O=Te(x.CONTAIN),n=y({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),re=y((X=r.zIndex)!=null?X:le()),ie=b(()=>{const{urlList:e}=r;return e.length<=1}),W=b(()=>u.value===0),q=b(()=>u.value===r.urlList.length-1),ce=b(()=>r.urlList[u.value]),ue=b(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!r.infinite&&W.value)]),de=b(()=>[s.e("btn"),s.e("next"),s.is("disabled",!r.infinite&&q.value)]),fe=b(()=>{const{scale:e,deg:o,offsetX:t,offsetY:i,enableTransition:f}=n.value;let v=t/e,g=i/e;const N=o*Math.PI/180,Z=Math.cos(N),j=Math.sin(N);v=v*Z+g*j,g=g*Z-t/e*j;const A={transform:`scale(${e}) rotate(${o}deg) translate(${v}px, ${g}px)`,transition:f?"transform .3s":""};return O.value.name===x.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A}),ve=b(()=>`${u.value+1} / ${r.urlList.length}`);function T(){pe(),$?.(),document.body.style.overflow=F,L("close")}function me(){const e=B(t=>{switch(t.code){case I.esc:r.closeOnPressEscape&&T();break;case I.space:M();break;case I.left:V();break;case I.up:p("zoomIn");break;case I.right:Y();break;case I.down:p("zoomOut");break}}),o=B(t=>{const i=t.deltaY||t.deltaX;p(i<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});K.run(()=>{z(document,"keydown",e),z(document,"wheel",o)})}function pe(){K.stop()}function ge(){_.value=!1}function be(e){_.value=!1,e.target.alt=oe("el.image.error")}function ke(e){if(_.value||e.button!==0||!S.value)return;n.value.enableTransition=!1;const{offsetX:o,offsetY:t}=n.value,i=e.pageX,f=e.pageY,v=B(N=>{n.value={...n.value,offsetX:o+N.pageX-i,offsetY:t+N.pageY-f}}),g=z(document,"mousemove",v);z(document,"mouseup",()=>{g()}),e.preventDefault()}function G(){n.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function M(){if(_.value)return;const e=We(x),o=Object.values(x),t=O.value.name,f=(o.findIndex(v=>v.name===t)+1)%e.length;O.value=x[e[f]],G()}function R(e){const o=r.urlList.length;u.value=(e+o)%o}function V(){W.value&&!r.infinite||R(u.value-1)}function Y(){q.value&&!r.infinite||R(u.value+1)}function p(e,o={}){if(_.value)return;const{minScale:t,maxScale:i}=r,{zoomRate:f,rotateDeg:v,enableTransition:g}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...o};switch(e){case"zoomOut":n.value.scale>t&&(n.value.scale=Number.parseFloat((n.value.scale/f).toFixed(3)));break;case"zoomIn":n.value.scale<i&&(n.value.scale=Number.parseFloat((n.value.scale*f).toFixed(3)));break;case"clockwise":n.value.deg+=v,L("rotate",n.value.deg);break;case"anticlockwise":n.value.deg-=v,L("rotate",n.value.deg);break}n.value.enableTransition=g}function we(e){var o;((o=e.detail)==null?void 0:o.focusReason)==="pointer"&&e.preventDefault()}function he(){r.closeOnPressEscape&&T()}function _e(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ee(ce,()=>{qe(()=>{const e=H.value[0];e?.complete||(_.value=!0)})}),ee(u,e=>{G(),L("switch",e)}),Re(()=>{me(),$=z("wheel",_e,{passive:!1}),F=document.body.style.overflow,document.body.style.overflow="hidden"}),ne({setActiveItem:R}),(e,o)=>(w(),ae(a(je),{to:"body",disabled:!e.teleported},{default:d(()=>[l($e,{name:"viewer-fade",appear:""},{default:d(()=>[m("div",{ref_key:"wrapper",ref:S,tabindex:-1,class:c(a(s).e("wrapper")),style:te({zIndex:re.value})},[l(a(Ze),{loop:"",trapped:"","focus-trap-el":S.value,"focus-start-el":"container",onFocusoutPrevented:we,onReleaseRequested:he},{default:d(()=>[m("div",{class:c(a(s).e("mask")),onClick:Se(t=>e.hideOnClickModal&&T(),["self"])},null,10,["onClick"]),h(" CLOSE "),m("span",{class:c([a(s).e("btn"),a(s).e("close")]),onClick:T},[l(a(k),null,{default:d(()=>[l(a(Me))]),_:1})],2),h(" ARROW "),a(ie)?h("v-if",!0):(w(),E(P,{key:0},[m("span",{class:c(a(ue)),onClick:V},[l(a(k),null,{default:d(()=>[l(a(Ve))]),_:1})],2),m("span",{class:c(a(de)),onClick:Y},[l(a(k),null,{default:d(()=>[l(a(Ye))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(w(),E("div",{key:1,class:c([a(s).e("btn"),a(s).e("progress")])},[D(e.$slots,"progress",{activeIndex:u.value,total:e.urlList.length},()=>[Ae(De(a(ve)),1)])],2)):h("v-if",!0),h(" ACTIONS "),m("div",{class:c([a(s).e("btn"),a(s).e("actions")])},[m("div",{class:c(a(s).e("actions__inner"))},[D(e.$slots,"toolbar",{actions:p,prev:V,next:Y,reset:M,activeIndex:u.value,setActiveItem:R},()=>[l(a(k),{onClick:t=>p("zoomOut")},{default:d(()=>[l(a(Pe))]),_:1},8,["onClick"]),l(a(k),{onClick:t=>p("zoomIn")},{default:d(()=>[l(a(Be))]),_:1},8,["onClick"]),m("i",{class:c(a(s).e("actions__divider"))},null,2),l(a(k),{onClick:M},{default:d(()=>[(w(),ae(Xe(a(O).icon)))]),_:1}),m("i",{class:c(a(s).e("actions__divider"))},null,2),l(a(k),{onClick:t=>p("anticlockwise")},{default:d(()=>[l(a(Fe))]),_:1},8,["onClick"]),l(a(k),{onClick:t=>p("clockwise")},{default:d(()=>[l(a(He))]),_:1},8,["onClick"])])],2)],2),h(" CANVAS "),m("div",{class:c(a(s).e("canvas"))},[(w(!0),E(P,null,Ke(e.urlList,(t,i)=>(w(),E(P,{key:i},[i===u.value?(w(),E("img",{key:0,ref_for:!0,ref:f=>H.value[i]=f,src:t,style:te(a(fe)),class:c(a(s).e("img")),crossorigin:e.crossorigin,onLoad:ge,onError:be,onMousedown:ke},null,46,["src","crossorigin"])):h("v-if",!0)],64))),128))],2),D(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var aa=Ce(ea,[["__file","image-viewer.vue"]]);const oa=Ge(aa);export{oa as E};
