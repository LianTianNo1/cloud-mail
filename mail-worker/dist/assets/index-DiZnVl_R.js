import{ak as V,S as Me,a2 as k,X as ke,s as g,a3 as Te,c as h,o as u,f as s,N as n,g as v,z as a,e as N,i as Ve,n as O,F as P,a5 as X,t as d,y as T,h as y,D as De,a0 as p}from"./index-CrVLGAV5.js";import{E as Ke,a as $e}from"./el-table-column-C1-20CeS.js";import"./el-checkbox-1PyqgUYo.js";import{E as be}from"./el-popper-CxTMhn_i.js";import{E as Ye}from"./el-scrollbar-C5dRdj6E.js";import{E as Ue}from"./el-dialog-Dc-uwvKn.js";/* empty css                       *//* empty css                  *//* empty css                 */import{E as Ie}from"./el-input-number-C6IFAgXf.js";import{E as Se}from"./el-date-picker-DJ1UK96n.js";import{E as xe,a as He}from"./el-select-C7rgYuUX.js";import{E as Be}from"./el-empty-CHUpR478.js";import{b as Ne,E as Le,a as Re}from"./el-dropdown-item-PNbSi3m1.js";import{I as w}from"./iconify-DfAVPzXa.js";import{l as Z}from"./index-wlxkN86N.js";import{u as ze,r as q}from"./role-qIGTCH-R.js";import{g as G}from"./text-C9KP7X7d.js";import{d as J}from"./dayjs.min-C76mOJ6D.js";import{t as Q}from"./day-BmPDsp6A.js";import{c as Ae}from"./clipboard-utils-CzPXxZBC.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as We}from"./vnode-DMmxwG2F.js";import{E as je}from"./index-Bi5OiBjY.js";import{E as ee}from"./index-BqKRmYx7.js";import"./index-xJ5jWlCl.js";import"./index-B5LOEhaN.js";import"./event-BB_Ol6Sd.js";import"./index-DXUHX4PR.js";import"./index-BwIXkj3G.js";function Oe(f){return V.get("/regKey/list",{params:{...f}})}function Pe(f){return V.post("/regKey/add",f)}function Xe(f){return V.delete("/regKey/delete?regKeyIds="+f)}function Ze(){return V.delete("/regKey/clearNotUse")}function qe(f){return V.get("/regKey/history",{params:{regKeyId:f}})}const Ge={class:"reg-key"},Je={class:"header-actions"},Qe={class:"search"},et={class:"code-box"},tt={class:"code-item"},ot={class:"code-info"},nt={class:"info-left"},lt={class:"info-left-item"},rt=["onClick"],st={class:"info-left-item"},at={key:0},it={class:"info-left-item"},ct={class:"info-left-item"},dt={key:0},ut={class:"info-right"},mt={key:0,class:"empty"},pt={class:"container"},ft=Object.assign({name:"reg-key"},{__name:"index",setup(f){const te=ze(),L=Me(),D=k({code:""}),{t:c}=ke(),E=k([]),U=g(!1),K=g(!1),I=g(!0),S=g(!0),x=g(!1),H=k([]),C=g(0),R=g(0),b=g(!1),oe=window.innerWidth<1025,i=k({code:"",count:1,roleId:null,expireTime:null}),Y=k([]);_(!0),q().then(t=>{E.length=0,E.push(...t)}),Te(()=>te.refresh,()=>{q().then(t=>{E.length=0,E.push(...t)})});function ne(t){H.length=0,b.value=!0,qe(t.regKeyId).then(e=>{if(H.push(...e),e.length>0){const l=e.reduce((m,M)=>z(m,M,"email")).email;C.value=G(l)+30,C.value=C.value<300?C.value:300;const r=e.reduce((m,M)=>z(m,M,"createTime")).createTime;R.value=G(r)}}).finally(()=>{b.value=!1}),x.value=!0}const z=(t,e,l)=>{const r=m=>(m.match(/[A-Z]/g)||[]).length;return t[l].length===e[l].length?r(t[l])>r(e[l])?t:e:t[l].length>e[l].length?t:e};function le(t){const e=Q(t.createTime),l=J().year(),r=e.year();return L.lang==="en"?r===l?e.format("MMM D, HH:mm"):e.format("MMM D, YYYY HH:mm"):r===l?e.format("M月D日 HH:mm"):e.format("YYYY年M月D日 HH:mm")}function re(t){const e=Q(t),l=J().year(),r=e.year();return L.lang==="en"?r===l?e.format("MMM D"):e.format("MMM D, YYYY"):r===l?e.format("M月D日"):e.format("YYYY年M月D日")}function se(){D.code=null,_(!0)}function ae(){_(!0)}function _(t=!1){t&&(I.value=!0),Oe(D).then(e=>{Y.length=0,Y.push(...e),I.value=!1,setTimeout(()=>{S.value=!1},200)})}async function A(t){try{await Ae(t),p({message:c("copySuccessMsg"),type:"success",plain:!0})}catch(e){console.error("复制失败:",e),p({message:"复制失败",type:"error",plain:!0})}}function F(){i.code=ie()}function ie(t=8){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let r=0;r<t;r++)l+=e.charAt(Math.floor(Math.random()*e.length));return l}function ce(){ee.confirm(c("clearRegKey"),{confirmButtonText:c("confirm"),cancelButtonText:c("cancel"),type:"warning"}).then(()=>{Ze().then(()=>{p({message:c("clearSuccess"),type:"success",plain:!0}),_()})})}function de(){if(!i.code){p({message:$("emptyRegKeyMsg"),type:"error",plain:!0});return}if(!i.roleId){p({message:c("emptyRole"),type:"error",plain:!0});return}if(!i.expireTime){p({message:c("emptyTimeMsg"),type:"error",plain:!0});return}if(!i.count){p({message:c("emptyCountMsg"),type:"error",plain:!0});return}U.value=!0,Pe(i).then(()=>{K.value=!1,me(),p({message:c("addSuccessMsg"),type:"success",plain:!0}),_()}).finally(()=>{U.value=!1})}function ue(t){ee.confirm(c("delConfirm",{msg:t.code}),{confirmButtonText:c("confirm"),cancelButtonText:c("cancel"),type:"warning"}).then(()=>{Xe([t.regKeyId]).then(()=>{_(),p({message:c("delSuccessMsg"),type:"success",plain:!0})})})}function me(){i.code=""}function pe(){F(),K.value=!0}return(t,e)=>{const l=We,r=be,m=Re,M=Le,fe=Ne,ge=Be,he=Ye,ye=He,_e=xe,ve=Se,we=Ie,Ee=je,W=Ue,j=$e,Ce=Ke;return u(),h("div",Ge,[s("div",Je,[n(v(w),{class:"icon",icon:"ion:add-outline",width:"23",height:"23",onClick:pe}),s("div",Qe,[n(l,{modelValue:D.code,"onUpdate:modelValue":e[0]||(e[0]=o=>D.code=o),class:"search-input",placeholder:t.$t("searchRegKeyDesc")},null,8,["modelValue","placeholder"])]),n(v(w),{class:"icon",icon:"iconoir:search",onClick:ae,width:"20",height:"20"}),n(v(w),{class:"icon",icon:"ion:reload",width:"18",height:"18",onClick:se}),n(v(w),{class:"icon",icon:"fluent:broom-sparkle-16-regular",width:"22",height:"22",onClick:ce})]),n(he,{class:"scrollbar"},{default:a(()=>[s("div",{class:O(["loading",I.value?"loading-show":"loading-hide"]),style:Ve(S.value?"background: transparent":"")},[n(Z)],6),s("div",et,[(u(!0),h(P,null,X(Y,o=>(u(),h("div",tt,[s("div",ot,[s("div",nt,[s("div",lt,[s("span",{class:"code",onClick:B=>A(o.code)},d(o.code),9,rt)]),s("div",st,[s("div",null,d(t.$t("remainingUses"))+"：",1),o.count?(u(),h("div",at,d(o.count),1)):(u(),T(r,{key:1,type:"danger"},{default:a(()=>[y(d(t.$t("exhausted")),1)]),_:1}))]),s("div",it,[s("div",null,d(t.$t("roleDesc"))+"：",1),n(r,null,{default:a(()=>[y(d(o.roleName),1)]),_:2},1024)]),s("div",ct,[s("div",null,d(t.$t("validUntil"))+"：",1),o.expireTime?(u(),h("div",dt,d(re(o.expireTime)),1)):(u(),T(r,{key:1,type:"danger"},{default:a(()=>[y(d(t.$t("expired")),1)]),_:1}))])]),s("div",ut,[n(fe,{class:"setting"},{dropdown:a(()=>[n(M,null,{default:a(()=>[n(m,{onClick:B=>A(o.code)},{default:a(()=>[y(d(t.$t("copy")),1)]),_:2},1032,["onClick"]),n(m,{onClick:B=>ne(o)},{default:a(()=>[y(d(t.$t("history")),1)]),_:2},1032,["onClick"]),n(m,{onClick:B=>ue(o)},{default:a(()=>[y(d(t.$t("delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[n(v(w),{icon:"fluent:settings-24-filled",width:"21",height:"21",color:"#909399"})]),_:2},1024)])])]))),256))]),Y.length===0?(u(),h("div",mt,[S.value?N("",!0):(u(),T(ge,{key:0,"image-size":oe?120:0,description:t.$t("noCodeFound")},null,8,["image-size","description"]))])):N("",!0)]),_:1}),n(W,{modelValue:K.value,"onUpdate:modelValue":e[5]||(e[5]=o=>K.value=o),title:t.$t("addRegKey")},{default:a(()=>[s("div",pt,[n(l,{modelValue:i.code,"onUpdate:modelValue":e[1]||(e[1]=o=>i.code=o),placeholder:t.$t("regKey")},{suffix:a(()=>[n(v(w),{onClick:De(F,["stop"]),class:"gen-code",icon:"bitcoin-icons:refresh-filled",width:"24",height:"24"})]),_:1},8,["modelValue","placeholder"]),n(_e,{modelValue:i.roleId,"onUpdate:modelValue":e[2]||(e[2]=o=>i.roleId=o),placeholder:t.$t("roleDesc")},{default:a(()=>[(u(!0),h(P,null,X(E,o=>(u(),T(ye,{label:o.name,value:o.roleId,key:o.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),n(ve,{modelValue:i.expireTime,"onUpdate:modelValue":e[3]||(e[3]=o=>i.expireTime=o),type:"date",placeholder:t.$t("validUntil")},null,8,["modelValue","placeholder"]),n(we,{modelValue:i.count,"onUpdate:modelValue":e[4]||(e[4]=o=>i.count=o),min:1,max:99999},null,8,["modelValue"]),n(Ee,{class:"btn",type:"primary",onClick:de,loading:U.value},{default:a(()=>[y(d(t.$t("add")),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue","title"]),n(W,{class:"history-list",modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=o=>x.value=o),title:t.$t("useHistory")},{default:a(()=>[s("div",{class:O(["loading",b.value?"loading-show":"loading-hide"])},[n(Z)],2),b.value?N("",!0):(u(),T(Ce,{key:0,data:H,fit:!0,style:{height:"100%"}},{default:a(()=>[n(j,{"min-width":C.value,property:"email",label:t.$t("user"),"show-overflow-tooltip":!0},null,8,["min-width","label"]),n(j,{width:R.value,formatter:le,property:"createTime",label:t.$t("date"),fixed:"right","show-overflow-tooltip":!0},null,8,["width","label"])]),_:1},8,["data"]))]),_:1},8,["modelValue","title"])])}}}),jt=Fe(ft,[["__scopeId","data-v-f0891234"]]);export{jt as default};
