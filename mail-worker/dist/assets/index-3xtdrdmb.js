import{X as Q,a1 as x,Y as ee,Z as te,S as se,s as w,a2 as z,a4 as B,k as R,ah as ae,c as p,al as oe,e as h,f as l,g as i,i as le,A as I,N as m,t as n,C as P,am as re,z as b,n as ie,y as V,F as K,h as M,o as r,D as j,a5 as J,a0 as u,an as ne,ao as de,W}from"./index-CrVLGAV5.js";/* empty css                  *//* empty css                 */import"./el-popper-CxTMhn_i.js";import{E as ue,a as ce}from"./el-select-C7rgYuUX.js";import"./el-scrollbar-C5dRdj6E.js";import{a as pe,r as me}from"./login-DZxwudd7.js";import{i as X}from"./verify-utils-D6Av2NDy.js";import{I as N}from"./iconify-DfAVPzXa.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as fe}from"./vnode-DMmxwG2F.js";import{E as ve}from"./index-Bi5OiBjY.js";import"./index-xJ5jWlCl.js";import"./index-DXUHX4PR.js";import"./index-B5LOEhaN.js";import"./event-BB_Ol6Sd.js";const ye={id:"login-box"},we={class:"form-wrapper"},he={class:"container"},ke={class:"brand-section"},be={class:"brand-icon"},Ve={class:"brand-content"},Se={class:"brand-title"},$e={key:0,class:"brand-subtitle"},Ee={key:1,class:"brand-subtitle"},Me={style:{color:"var(--el-text-color-primary)"}},_e=["data-sitekey"],Ce={key:0,style:{"font-size":"12px",color:"#F56C6C"}},Ue={__name:"index",setup(Te){const{t:d}=Q(),Y=x(),Z=ee(),D=te(),o=se(),_=w(!1),g=w("login"),v=z({email:"",password:""}),C=w(),c=w(""),a=z({email:"",password:"",confirmPassword:"",code:null}),U=o.domainList,E=w(!1);c.value=U[0];const S=w(!1);let $="",y=null,T=w(!1),F=0;window.onTurnstileSuccess=e=>{$=e},window.onTurnstileError=e=>{F>=4||(F++,console.warn("人机验加载失败",e),setTimeout(()=>{B(()=>{y?window.turnstile.reset(y):y=window.turnstile.render(".register-turnstile")})},1500))},window.loadAfter=e=>{console.log("loadAfter")},window.loadBefore=e=>{console.log("loadBefore")},R(()=>{const e=o.settings.loginOpacity;return D.dark?`rgba(0, 0, 0, ${e})`:`rgba(255, 255, 255, ${e})`});const q=R(()=>o.settings.background?{"background-image":`url(${ae(o.settings.background)})`,"background-repeat":"no-repeat","background-size":"cover","background-position":"center"}:""),L=()=>{C.value.toggleMenu()},G=()=>{if(!v.email){u({message:d("emptyEmailMsg"),type:"error",plain:!0});return}let e=v.email+(o.settings.loginDomain===0?c.value:"");if(!X(e)){u({message:d("notEmailMsg"),type:"error",plain:!0});return}if(!v.password){u({message:d("emptyPwdMsg"),type:"error",plain:!0});return}_.value=!0,pe(e,v.password).then(async t=>{localStorage.setItem("token",t.token);const k=await ne();Y.currentAccountId=k.accountId,Z.user=k,de(k.permKeys).forEach(f=>{W.addRoute("layout",f)}),await W.replace({name:"layout"}),D.showNotice()}).finally(()=>{_.value=!1})};function H(){if(!a.email){u({message:d("emptyEmailMsg"),type:"error",plain:!0});return}if(!X(a.email+c.value)){u({message:d("notEmailMsg"),type:"error",plain:!0});return}if(!a.password){u({message:d("emptyPwdMsg"),type:"error",plain:!0});return}if(a.password.length<6){u({message:d("pwdLengthMsg"),type:"error",plain:!0});return}if(a.password!==a.confirmPassword){u({message:d("confirmPwdFailMsg"),type:"error",plain:!0});return}if(o.settings.regKey===0&&!a.code){u({message:d("emptyRegKeyMsg"),type:"error",plain:!0});return}if(!$&&(o.settings.registerVerify===0||o.settings.registerVerify===2&&o.settings.regVerifyOpen)){S.value?T.value||u({message:d("botVerifyMsg"),type:"error",plain:!0}):(S.value=!0,B(()=>{if(y)window.turnstile.reset(".register-turnstile");else try{y=window.turnstile.render(".register-turnstile")}catch{T.value=!0,console.log("人机验证js加载失败")}}));return}E.value=!0;const e={email:a.email+c.value,password:a.password,token:$,code:a.code};me(e).then(({regVerifyOpen:t})=>{g.value="login",a.email="",a.password="",a.confirmPassword="",a.code="",E.value=!1,$="",o.settings.regVerifyOpen=t,S.value=!1,u({message:d("regSuccessMsg"),type:"success",plain:!0})}).catch(t=>{E.value=!1,t.code===400&&($="",o.settings.regVerifyOpen=!0,y?window.turnstile.reset(y):B(()=>{y=window.turnstile.render(".register-turnstile")}),S.value=!0)})}return(e,t)=>{const k=ce,A=ue,f=fe,O=ve;return r(),p("div",ye,[t[11]||(t[11]=oe('<div class="premium-background" data-v-5d21cf55><div class="gradient-orb orb-1" data-v-5d21cf55></div><div class="gradient-orb orb-2" data-v-5d21cf55></div><div class="gradient-orb orb-3" data-v-5d21cf55></div><div class="floating-shapes" data-v-5d21cf55><div class="shape shape-1" data-v-5d21cf55></div><div class="shape shape-2" data-v-5d21cf55></div><div class="shape shape-3" data-v-5d21cf55></div><div class="shape shape-4" data-v-5d21cf55></div><div class="shape shape-5" data-v-5d21cf55></div><div class="shape shape-6" data-v-5d21cf55></div></div><div class="mesh-gradient" data-v-5d21cf55></div></div>',1)),i(o).settings.background?(r(),p("div",{key:0,style:le(q.value),class:"custom-background"},null,4)):h("",!0),l("div",we,[l("div",he,[l("div",ke,[l("div",be,[m(i(N),{icon:"fluent:mail-24-filled",width:"32",height:"32"})]),l("div",Ve,[l("h1",Se,n(i(o).settings.title),1),g.value==="login"?(r(),p("p",$e,n(e.$t("loginTitle")),1)):(r(),p("p",Ee,n(e.$t("regTitle")),1))])]),I(l("div",null,[m(f,{class:ie(i(o).settings.loginDomain===0?"email-input":""),modelValue:v.email,"onUpdate:modelValue":t[1]||(t[1]=s=>v.email=s),type:"text",placeholder:e.$t("emailAccount"),autocomplete:"off"},re({_:2},[i(o).settings.loginDomain===0?{name:"append",fn:b(()=>[l("div",{onClick:j(L,["stop"])},[g.value==="login"?(r(),V(A,{key:0,ref_key:"mySelect",ref:C,modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),placeholder:e.$t("select"),class:"select"},{default:b(()=>[(r(!0),p(K,null,J(i(U),s=>(r(),V(k,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])):h("",!0),l("div",Me,[l("span",null,n(c.value),1),m(i(N),{class:"setting-icon",icon:"mingcute:down-small-fill",width:"20",height:"20"})])])]),key:"0"}:void 0]),1032,["class","modelValue","placeholder"]),m(f,{modelValue:v.password,"onUpdate:modelValue":t[2]||(t[2]=s=>v.password=s),placeholder:e.$t("password"),type:"password",autocomplete:"off"},null,8,["modelValue","placeholder"]),m(O,{class:"btn",type:"primary",onClick:G,loading:_.value},{default:b(()=>[M(n(e.$t("loginBtn")),1)]),_:1},8,["loading"])],512),[[P,g.value==="login"]]),I(l("div",null,[m(f,{class:"email-input",modelValue:a.email,"onUpdate:modelValue":t[4]||(t[4]=s=>a.email=s),type:"text",placeholder:e.$t("emailAccount"),autocomplete:"off"},{append:b(()=>[l("div",{onClick:j(L,["stop"])},[g.value!=="login"?(r(),V(A,{key:0,ref_key:"mySelect",ref:C,modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=s=>c.value=s),placeholder:e.$t("select"),class:"select"},{default:b(()=>[(r(!0),p(K,null,J(i(U),s=>(r(),V(k,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])):h("",!0),l("div",null,[l("span",null,n(c.value),1),m(i(N),{class:"setting-icon",icon:"mingcute:down-small-fill",width:"20",height:"20"})])])]),_:1},8,["modelValue","placeholder"]),m(f,{modelValue:a.password,"onUpdate:modelValue":t[5]||(t[5]=s=>a.password=s),placeholder:e.$t("password"),type:"password",autocomplete:"off"},null,8,["modelValue","placeholder"]),m(f,{modelValue:a.confirmPassword,"onUpdate:modelValue":t[6]||(t[6]=s=>a.confirmPassword=s),placeholder:e.$t("confirmPwd"),type:"password",autocomplete:"off"},null,8,["modelValue","placeholder"]),i(o).settings.regKey===0?(r(),V(f,{key:0,modelValue:a.code,"onUpdate:modelValue":t[7]||(t[7]=s=>a.code=s),placeholder:e.$t("regKey"),type:"text",autocomplete:"off"},null,8,["modelValue","placeholder"])):h("",!0),i(o).settings.regKey===2?(r(),V(f,{key:1,modelValue:a.code,"onUpdate:modelValue":t[8]||(t[8]=s=>a.code=s),placeholder:e.$t("regKeyOptional"),type:"text",autocomplete:"off"},null,8,["modelValue","placeholder"])):h("",!0),I(l("div",{class:"register-turnstile","data-sitekey":i(o).settings.siteKey,"data-callback":"onTurnstileSuccess","data-error-callback":"onTurnstileError","data-after-interactive-callback":"loadAfter","data-before-interactive-callback":"loadBefore"},[i(T)?(r(),p("span",Ce,n(e.$t("verifyModuleFailed")),1)):h("",!0)],8,_e),[[P,S.value]]),m(O,{class:"btn",type:"primary",onClick:H,loading:E.value},{default:b(()=>[M(n(e.$t("regBtn")),1)]),_:1},8,["loading"])],512),[[P,g.value!=="login"]]),i(o).settings.register===0?(r(),p(K,{key:0},[g.value==="login"?(r(),p("div",{key:0,class:"switch",onClick:t[9]||(t[9]=s=>g.value="register")},[M(n(e.$t("noAccount"))+" ",1),l("span",null,n(e.$t("regSwitch")),1)])):(r(),p("div",{key:1,class:"switch",onClick:t[10]||(t[10]=s=>g.value="login")},[M(n(e.$t("hasAccount"))+" ",1),l("span",null,n(e.$t("loginSwitch")),1)]))],64)):h("",!0)])])])}}},Ye=ge(Ue,[["__scopeId","data-v-5d21cf55"]]);export{Ye as default};
